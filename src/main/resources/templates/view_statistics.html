<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Comando Delta</title>
    <link rel="icon" th:href="@{../logo.png}" type="image/jpeg"> 
</head>
<body class="bg-gray-200">
    <nav th:replace="/fragments/nav" :: nav></nav>

    <h1 class="text-center text-5xl font-black uppercase text-blue-700 mb-10 mt-10">
        Estadisticas Servicios
    </h1>

    <div class="w-1/3 mx-auto mb-10">
        <canvas id="serviceChart"></canvas>
    </div>

    <p class="text-center text-xs text-gray-900 mt-4 mb-10">
        Desarrollado por Martín Herrera Ramírez © 2025
    </p>

    <script th:inline="javascript">
        const stats = /*[[${stats}]]*/ [];
        const labels = [];
        const data = [];

        stats.forEach(stat => {
        labels.push(stat.serviceType);
        data.push(stat.total);
        });

        const ctx = document.getElementById('serviceChart').getContext('2d');
        new Chart(ctx, {
        type: 'pie',
        data: {
            labels: labels,
            datasets: [{
            label: 'Cantidad total de servicios',
            data: data,
            backgroundColor: [
                '#1f77b4', '#ff7f0e', '#2ca02c', '#d62728',
                '#9467bd', '#8c564b', '#e377c2', '#7f7f7f'
            ],
            borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
            datalabels: {
                formatter: (value, context) => {
                const total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                const percentage = (value / total * 100).toFixed(1);
                return `${percentage}%`;
                },
                color: '#fff',
                font: {
                weight: 'bold',
                size: 14
                }
            }
            }
        },
        plugins: [ChartDataLabels]
        });
    </script>
</body>
</html>
